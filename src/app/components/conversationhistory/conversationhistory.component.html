<!-- <p>conversationhistory works!</p> -->

<div class="background container">
    <nav class="chat-navbar">
    <div class="custom-container">
        <div class="custom-user-profile">
            <div class="custom-user-image">
                <span>{{ clickedUserName!.charAt(0).toUpperCase() }}</span>
           </div>
        </div>
        <div style="color: white;">{{ clickedUserName }} {{isGroup}} </div>
        
        <h3 class="mb-0 ms-3">{{ selectedUserName }}</h3>
        <div *ngIf="isReceiverIdNull" class="sticky-header-content">
          <span *ngFor="let member of groupmembers">
            <p class="small text-muted group-users" [ngClass]="{'admin': member.isAdmin}" [ngStyle]="{'color': member.isAdmin ? 'green' : 'white'}">
              <small>&nbsp;{{ member.userName }}</small>
            </p>            
          </span>
          <button *ngIf="isGroup" mat-icon-button [matMenuTriggerFor]="moreOptionsMenu">
            <mat-icon>more_vert</mat-icon>
          </button>
          <mat-menu #moreOptionsMenu="matMenu">
            <button mat-menu-item (click)="addMembers()"*ngIf="isCurrentUserAdminInGroup">Add Members</button>
            <button mat-menu-item (click)="removeMember()"*ngIf="isCurrentUserAdminInGroup">Remove Member</button>
            <button mat-menu-item (click)="editGroupName()">Edit Group Name</button>
            <button mat-menu-item (click)="deleteGroup()"*ngIf="isCurrentUserAdminInGroup">Delete Group</button>
            <button mat-menu-item (click)="makeMemberAdmin()"*ngIf="isCurrentUserAdminInGroup">Make Admin</button>
          </mat-menu>
        </div>  
    </div>
</nav>

<div class="history-container" #userChat (scroll)="onScroll(userChat)">
    <div *ngFor="let message of messages" 
    [ngClass]="{'message-left': message.senderId === clickedUserId, 'message-right': message.senderId !== clickedUserId}"
    (mouseenter)="showReplyButton(message)" (mouseleave)="hideReplyButton(message)" (contextmenu)="onContextMenu($event, message)">
        <div>{{ message.content }}</div>
        <small>{{ message.timestamp | date: 'medium' }}</small>
        <button *ngIf="message.showReplyButton" (click)="openThreadComponent(message)">Reply in Thread</button>
        <div *ngIf="contextMenuVisible && message.senderId !== clickedUserId && message.content == selectedMessage.content" class="context-menu">
            <button (click)="editMessage()">Edit</button>
            <button (click)="deleteMessage()">Delete</button>
        </div>
    </div>
</div>


<div *ngIf="isEditing">
    <input type="text" [(ngModel)]="editedMessageContent">
    <button (click)="acceptEditMessage()">Accept</button>
    <button (click)="declineEditMessage()">Decline</button>
</div>

<div *ngIf="isDeleting">
    <button (click)="acceptDeleteMessage()">Accept</button>
    <button (click)="declineDeleteMessage()">Decline</button>
</div>

<div class="send-chat">
    <input type="text" placeholder="Type your message..." [(ngModel)]="messageContent"/>
    <button class="send-button" (click)="sendMessage()">Send</button>
  </div>

</div>
